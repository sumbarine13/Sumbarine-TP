-- // Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")

-- // Variables
local lp = Players.LocalPlayer
local char = lp.Character or lp.CharacterAdded:Wait()
local savedPos = nil
local carpetSpoofActive = true

lp.CharacterAdded:Connect(function(nc) char = nc end)

-- // UI Creation
local gui = Instance.new("ScreenGui", CoreGui); gui.Name = "Sumbarine_Final_UI"
local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0, 300, 0, 300) -- Larger frame for better spacing
frame.Position = UDim2.new(0.5, -150, 0.4, 0)
frame.BackgroundColor3 = Color3.fromRGB(15, 15, 18)
frame.Active = true
frame.Draggable = true
Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 12)

local stroke = Instance.new("UIStroke", frame); stroke.Thickness = 3

-- Main Title
local title = Instance.new("TextLabel", frame)
title.Size = UDim2.new(1, 0, 0, 40)
title.Position = UDim2.new(0, 0, 0, 10)
title.BackgroundTransparency = 1
title.Text = "SUMBARINE'S TP"
title.Font = Enum.Font.GothamBlack
title.TextScaled = true
title.TextColor3 = Color3.new(1, 1, 1)

-- Sub-header Instruction
local subTitle = Instance.new("TextLabel", frame)
subTitle.Size = UDim2.new(1, 0, 0, 20)
subTitle.Position = UDim2.new(0, 0, 0, 45)
subTitle.BackgroundTransparency = 1
subTitle.Text = "Must hold Magic Carpet to bypass"
subTitle.Font = Enum.Font.GothamBold
subTitle.TextSize = 14
subTitle.TextColor3 = Color3.fromRGB(200, 200, 200)

-- Rainbow Effect Loop
task.spawn(function()
    while task.wait() do
        local color = Color3.fromHSV(tick() % 5 / 5, 0.8, 1)
        stroke.Color = color
        title.TextColor3 = color
    end
end)

-- Improved Button Function
local function makeBtn(text, y, color)
    local b = Instance.new("TextButton", frame)
    b.Size = UDim2.new(0.85, 0, 0, 50)
    b.Position = UDim2.new(0.075, 0, 0, y)
    b.Text = text
    b.Font = Enum.Font.GothamBlack
    b.TextScaled = true -- Fixes small text issue
    b.BackgroundColor3 = color
    b.TextColor3 = Color3.new(1, 1, 1)
    
    local padding = Instance.new("UIPadding", b)
    padding.PaddingTop = UDim.new(0, 8)
    padding.PaddingBottom = UDim.new(0, 8)
    
    Instance.new("UICorner", b).CornerRadius = UDim.new(0, 8)
    return b
end

local setBtn = makeBtn("SET LOCATION", 80, Color3.fromRGB(35, 35, 40))
local tpBtn = makeBtn("BYPASS TELEPORT", 145, Color3.fromRGB(160, 20, 40))
local resetBtn = makeBtn("RESET POSITION", 210, Color3.fromRGB(55, 55, 60))

-- // GHOST-CARPET SPOOF
task.spawn(function()
    while true do
        if carpetSpoofActive and char then
            local backpack = lp:FindFirstChild("Backpack")
            if backpack then
                local carpet = backpack:FindFirstChild("Magic Carpet") or char:FindFirstChild("Magic Carpet")
                if carpet then
                    carpet.Parent = char
                    carpet:Activate()
                end
            end
        end
        task.wait(0.1)
    end
end)

-- // BYPASS TP LOGIC
tpBtn.MouseButton1Click:Connect(function()
    if not savedPos or not char:FindFirstChild("HumanoidRootPart") then 
        tpBtn.Text = "SET POS FIRST!"
        task.wait(1.5)
        tpBtn.Text = "BYPASS TELEPORT"
        return 
    end
    
    local hrp = char.HumanoidRootPart
    local hum = char:FindFirstChildOfClass("Humanoid")
    
    tpBtn.Text = "BYPASSING..."
    hum:ChangeState(Enum.HumanoidStateType.Physics)
    
    local nc = RunService.Stepped:Connect(function()
        for _, v in pairs(char:GetDescendants()) do
            if v:IsA("BasePart") then v.CanCollide = false end
        end
    end)

    hrp.Anchored = true
    task.wait(0.05) 
    char:PivotTo(savedPos * CFrame.new(0, 2, 0)) 
    task.wait(0.2) 
    
    hrp.Anchored = false
    nc:Disconnect()
    hum:ChangeState(Enum.HumanoidStateType.Running)
    
    tpBtn.Text = "TP SUCCESS"
    task.wait(1)
    tpBtn.Text = "BYPASS TELEPORT"
end)

setBtn.MouseButton1Click:Connect(function()
    if char:FindFirstChild("HumanoidRootPart") then
        savedPos = char:GetPivot()
        setBtn.Text = "POSITION SAVED"
        task.wait(1.5)
        setBtn.Text = "SET LOCATION"
    end
end)

resetBtn.MouseButton1Click:Connect(function()
    savedPos = nil
    resetBtn.Text = "CLEARED"
    task.wait(1.5)
    resetBtn.Text = "RESET POSITION"
end)
